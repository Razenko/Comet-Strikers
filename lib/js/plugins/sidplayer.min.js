(function(){var e=this,a=function(e){if(Phaser.Plugins.BasePlugin.call(this,e),bufferlen=16384,background_noise=5e-4,this.author="Hermit",this.sourcecode="http://hermit.sidrip.com",this.version="0.9.1",this.year="2016","undefined"!=typeof AudioContext)var a=new AudioContext;else a=new webkitAudioContext;var t=a.sampleRate;if("function"==typeof a.createJavaScriptNode)var r=a.createJavaScriptNode(bufferlen,0,1);else r=a.createScriptProcessor(bufferlen,0,1);r.onaudioprocess=function(e){for(var a=e.outputBuffer,t=a.getChannelData(0),r=0;r<a.length;r++)t[r]=N()},this.loadstart=function(e,a){this.loadinit(e,a),null!==x&&x(),this.playcont()},this.loadLocal=function(e,a){S=0,this.pause(),We(),p=a;var t,r,n=new Uint8Array(e),s=n[7];for(b=n[8]+n[9]?256*n[8]+n[9]:n[s]+256*n[s+1],t=0;t<32;t++)f[31-t]=n[18+(t>>3)]&Math.pow(2,7-t%8);for(t=0;t<v.length;t++)v[t]=0;for(t=s+2;t<n.byteLength;t++)b+t-(s+2)<v.length&&(v[b+t-(s+2)]=n[t]);for(r=1,t=0;t<32;t++)r=o[t]=0!=r?n[22+t]:0;for(r=1,t=0;t<32;t++)r=u[t]=0!=r?n[54+t]:0;for(r=1,t=0;t<32;t++)r=l[t]=0!=r?n[86+t]:0;h=n[10]+n[11]?256*n[10]+n[11]:b,d=k=256*n[12]+n[13],y=n[15],g[0]=32<=(48&n[119])?8580:6581,g[1]=128<=(192&n[119])?8580:6581,g[2]=3<=(3&n[118])?8580:6581,P[1]=66<=n[122]&&(n[122]<128||224<=n[122])?53248+16*n[122]:0,P[2]=66<=n[123]&&(n[123]<128||224<=n[123])?53248+16*n[123]:0,B=1+(0<P[1])+(0<P[2]),S=1,L(p),this.playcont()},this.start=function(e){L(e),null!==x&&x(),this.playcont()},this.playcont=function(){r.connect(a.destination)},this.pause=function(){S&&_&&r.disconnect(a.destination)},this.stop=function(){this.pause(),L(p)},this.gettitle=function(){return String.fromCharCode.apply(null,o)},this.getauthor=function(){return String.fromCharCode.apply(null,u)},this.getinfo=function(){return String.fromCharCode.apply(null,l)},this.getsubtunes=function(){return y},this.getprefmodel=function(){return g[0]},this.getmodel=function(){return m},this.getoutput=function(){return pe/i*(15&v[54296])},this.getplaytime=function(){return parseInt(playtime)},this.setmodel=function(e){m=e},this.setvolume=function(e){U=e},this.setloadcallback=function(e){e},this.setstartcallback=function(e){x=e},this.setendcallback=function(e,a){endcallback=e,w=a};var n=50,s=3,i=65536*s*16,c=[0,1,.6,.4],o=new Uint8Array(32),u=new Uint8Array(32),l=new Uint8Array(32),f=new Uint8Array(32),b=4096,h=4096,k=4099,d=4099,p=0,y=1,w=0,g=[8580,8580,8580],m=8580,P=[54272,0,0],v=new Uint8Array(65536),S=0,_=0,A=0,x=null;endcallback=null,playtime=0,ended=0;var C,M=985248/t,I=t/n,T=1,U=1,D=0,B=1,J=0;function L(e){if(S){_=0,p=e,X(h),We(),R=p,v[1]=55,v[56325]=0;for(var a=1e5;0<=a&&!Y();a--);f[p]||v[56325]?(v[56325]||(v[56324]=36,v[56325]=64),I=(v[56324]+256*v[56325])/M):I=t/n,0==k?d=(3&v[1])<2?v[65534]+256*v[65535]:v[788]+256*v[789]:57344<=(d=k)&&55==v[1]&&(v[1]=53),X(d),T=1,D=A=0,playtime=0,ended=0,_=1}}function N(){if(S&&_&&(T--,playtime+=1/t,T<=0&&(T=I,A=0,O=d,F=255),0==A)){for(;D<=M;){if(C=O,254<=Y()){A=1;break}if(D+=V,1<(3&v[1])&&C<57344&&(59953==O||60033==O)){A=1;break}(56325==K||56324==K)&&3&v[1]&&f[p]&&(I=(v[56324]+256*v[56325])/M),54304<=W&&W<55296&&3&v[1]&&(P[1]<=W&&W<P[1]+31||P[2]<=W&&W<P[2]+31||(v[54303&W]=v[W])),54276!=K||1&v[54276]||(Be[0]&=62),54283!=K||1&v[54283]||(Be[1]&=62),54290!=K||1&v[54290]||(Be[2]&=62)}D-=M}return 0<w&&parseInt(playtime)==parseInt(w)&&null!==endcallback&&0==ended&&(ended=1,endcallback()),J=Xe(0,54272),P[1]&&(J+=Xe(1,P[1])),P[2]&&(J+=Xe(2,P[2])),J*U*c[B]+(Math.random()*background_noise-background_noise/2)}var j=[1,33,4,36,0,64,8,40],H=[128,64,1,2],O=0,R=0,q=0,z=0,E=0,F=255,G=0,K=0,Q=0,V=0,W=0;function X(e){O=e,Q=E=z=R=0,F=255}function Y(){if(G=v[O],V=2,W=0,1&G){switch(31&G){case 1:case 3:K=v[v[++O]+z]+256*v[v[O]+z+1],V=6;break;case 17:case 19:K=v[v[++O]]+256*v[v[O]+1]+E,V=6;break;case 25:case 31:K=v[++O]+256*v[++O]+E,V=5;break;case 29:K=v[++O]+256*v[++O]+z,V=5;break;case 13:case 15:K=v[++O]+256*v[++O],V=4;break;case 21:K=v[++O]+z,V=4;break;case 5:case 7:K=v[++O],V=3;break;case 23:K=v[++O]+E,V=4;break;case 9:case 11:K=++O,V=2}switch(K&=65535,224&G){case 96:q=R,R+=v[K]+(1&Q),Q&=20,Q|=128&R|255<R,Q|=!(R&=255)<<1|(!(128&(q^v[K]))&&128&(q^R))>>1;break;case 224:q=R,R-=v[K]+!(1&Q),Q&=20,Q|=128&R|0<=R,Q|=!(R&=255)<<1|(128&(q^v[K])&&128&(q^R))>>1;break;case 192:q=R-v[K],Q&=124,Q|=!(255&q)<<1|128&q|0<=q;break;case 0:R|=v[K],Q&=125,Q|=!R<<1|128&R;break;case 32:R&=v[K],Q&=125,Q|=!R<<1|128&R;break;case 64:R^=v[K],Q&=125,Q|=!R<<1|128&R;break;case 160:R=v[K],Q&=125,Q|=!R<<1|128&R,3==(3&G)&&(z=R);break;case 128:v[K]=R&(3==(3&G)?z:255),W=K}}else if(2&G){switch(31&G){case 30:K=v[++O]+256*v[++O]+(128!=(192&G)?z:E),V=5;break;case 14:K=v[++O]+256*v[++O],V=4;break;case 22:K=v[++O]+(128!=(192&G)?z:E),V=4;break;case 6:K=v[++O],V=3;break;case 2:K=++O,V=2}switch(K&=65535,224&G){case 0:Q&=254;case 32:10==(15&G)?(R=(R<<1)+(1&Q),Q&=60,Q|=128&R|255<R,Q|=!(R&=255)<<1):(q=(v[K]<<1)+(1&Q),Q&=60,Q|=128&q|255<q,Q|=!(q&=255)<<1,v[K]=q,V+=2);break;case 64:Q&=254;case 96:10==(15&G)?(R=((q=R)>>1)+128*(1&Q),Q&=60,Q|=128&R|1&q,Q|=!(R&=255)<<1):(q=(v[K]>>1)+128*(1&Q),Q&=60,Q|=128&q|1&v[K],Q|=!(q&=255)<<1,v[K]=q,V+=2);break;case 192:4&G?(v[K]--,v[K]&=255,Q&=125,Q|=!v[K]<<1|128&v[K],V+=2):(z--,Q&=125,Q|=!(z&=255)<<1|128&z);break;case 160:if(10!=(15&G))z=v[K];else{if(16&G){z=F;break}z=R}Q&=125,Q|=!z<<1|128&z;break;case 128:4&G?(v[K]=z,W=K):16&G?F=z:(Q&=125,Q|=!(R=z)<<1|128&R);break;case 224:4&G&&(v[K]++,v[K]&=255,Q&=125,Q|=!v[K]<<1|128&v[K],V+=2)}}else if(8==(12&G))switch(240&G){case 96:F++,R=v[256+(F&=255)],Q&=125,Q|=!R<<1|128&R,V=4;break;case 192:E++,Q&=125,Q|=!(E&=255)<<1|128&E;break;case 224:z++,Q&=125,Q|=!(z&=255)<<1|128&z;break;case 128:E--,Q&=125,Q|=!(E&=255)<<1|128&E;break;case 0:v[256+F]=Q,F--,F&=255,V=3;break;case 32:F++,Q=v[256+(F&=255)],V=4;break;case 64:v[256+F]=R,F--,F&=255,V=3;break;case 144:Q&=125,Q|=!(R=E)<<1|128&R;break;case 160:Q&=125,Q|=!(E=R)<<1|128&E;break;default:32&j[G>>5]?Q|=223&j[G>>5]:Q&=255-(223&j[G>>5])}else if(16==(31&G))128&(q=v[++O])&&(q-=256),32&G?Q&H[G>>6]&&(O+=q,V=3):Q&H[G>>6]||(O+=q,V=3);else{switch(31&G){case 0:K=++O,V=2;break;case 28:K=v[++O]+256*v[++O]+z,V=5;break;case 12:K=v[++O]+256*v[++O],V=4;break;case 20:K=v[++O]+z,V=4;break;case 4:K=v[++O],V=3}switch(K&=65535,224&G){case 0:v[256+F]=O%256,F--,v[256+(F&=255)]=O/256,F--,v[256+(F&=255)]=Q,F--,F&=255,O=v[65534]+256*v[65535]-1,V=7;break;case 32:15&G?(Q&=61,Q|=192&v[K]|!(R&v[K])<<1):(v[256+F]=(O+2)%256,F--,v[256+(F&=255)]=(O+2)/256,F--,F&=255,O=v[K]+256*v[K+1]-1,V=6);break;case 64:if(15&G)O=K-1,V=3;else{if(255<=F)return 254;F++,Q=v[256+(F&=255)],F++,q=v[256+(F&=255)],F++,O=v[256+(F&=255)]+256*q-1,V=6}break;case 96:if(15&G)O=v[K]+256*v[K+1]-1,V=5;else{if(255<=F)return 255;F++,q=v[256+(F&=255)],F++,O=v[256+(F&=255)]+256*q-1,V=6}break;case 192:q=E-v[K],Q&=124,Q|=!(255&q)<<1|128&q|0<=q;break;case 224:q=z-v[K],Q&=124,Q|=!(255&q)<<1|128&q|0<=q;break;case 160:E=v[K],Q&=125,Q|=!E<<1|128&E;break;case 128:v[K]=E,W=K}}return O++,O&=65535,0}var Z,$,ee,ae,te,re,ne,se,ie,ce,oe,ue,le,fe,be,he,ke,de,pe,ye=1,we=2,ge=4,me=8,Pe=16,ve=32,Se=64,_e=128,Ae=16,xe=64,Ce=128,Me=[1,2,4,1,2,4,1,2,4],Ie=16,Te=32,Ue=64,De=128,Be=[0,0,0,0,0,0,0,0,0],Je=[0,0,0,0,0,0,0,0,0],Le=[0,0,0,0,0,0,0,0,0],Ne=[0,0,0,0,0,0,0,0,0],je=[0,0,0,0,0,0,0,0,0],He=[0,0,0,0,0,0,0,0,0],Oe=[0,0,0,0,0,0,0,0,0],Re=[0,0,0],qe=[0,0,0],ze=[8388600,8388600,8388600,8388600,8388600,8388600,8388600,8388600,8388600],Ee=[0,0,0,0,0,0,0,0,0],Fe=[0,0,0,0,0,0,0,0,0],Ge=[0,0,0],Ke=[0,0,0],Qe=-306.640625/t,Ve=-490.625/t;function We(){for(var e=54272;e<=55295;e++)v[e]=0;for(e=56832;e<=57343;e++)v[e]=0;for(e=0;e<9;e++)Be[e]=Ae,Je[e]=Le[e]=Ne[e]=je[e]=0}function Xe(e,a){pe=de=0;for(var t=e*s;t<(e+1)*s;t++)$=Be[t]&ye,ae=v[(ee=a+7*(t-e*s))+4],te=240&ae,re=ae&me,ie=v[ee+6],ue=0,$!=(ae&ye)&&($?Be[t]&=255-(ye|Ce|xe):(Be[t]=ye|Ce|xe,(15&ie)>(15&je[t])&&(ue=1))),je[t]=ie,Je[t]+=M,32768<=Je[t]&&(Je[t]-=32768),Be[t]&Ce?(se=v[ee+5]>>4,ne=ea[se]):Be[t]&xe?(se=15&v[ee+5],ne=ea[se]):ne=ea[se=15&ie],se=aa[se],Je[t]>=ne&&Je[t]<ne+M&&0==ue&&(Je[t]-=ne,(Be[t]&Ce||++Ne[t]==ta[Le[t]])&&(Be[t]&Ae||(Be[t]&Ce?(Le[t]+=se,255<=Le[t]&&(Le[t]=255,Be[t]&=255-Ce)):Be[t]&xe&&!(Le[t]>(ie>>4)+(240&ie))||(Le[t]-=se,Le[t]<=0&&Le[t]+se!=0&&(Le[t]=0,Be[t]|=Ae))),Ne[t]=0)),Le[t]&=255,ce=(v[ee]+256*v[ee+1])*M,re||ae&we&&Re[e]?He[t]=0:(He[t]+=ce,16777215<He[t]&&(He[t]-=16777216)),oe=8388608&He[t],Re[e]=oe>(8388608&Oe[t])?1:0,te&_e?(ue=ze[t],((1048576&He[t])!=(1048576&Oe[t])||1048576<=ce)&&(ue=(ue<<1)+(0<(se=4194304&ue^(131072&ue)<<5)||re)&8388607,ze[t]=ue),be=112&te?0:((1048576&ue)>>5)+((262144&ue)>>4)+((16384&ue)>>1)+((2048&ue)<<1)+((512&ue)<<2)+((32&ue)<<5)+((4&ue)<<7)+((1&ue)<<8)):te&Se?(le=16*(v[ee+2]+256*(15&v[ee+3])),ue=ce>>9,0<le&&le<ue&&(le=ue),(ue^=65535)<le&&(le=ue),ue=He[t]>>8,te==Se?(se=256/(ce>>16),re?be=65535:ue<le?(65535<(fe=(65535-le)*se)&&(fe=65535),(be=fe-(le-ue)*se)<0&&(be=0)):(65535<(fe=le*se)&&(fe=65535),0<=(be=(65535-ue)*se-fe)&&(be=65535),be&=65535)):(be=le<=ue||re?65535:0,te&Pe?te&ve?be=be?Ye(t,PulseTriSaw_8580,ue>>4,1):0:(ue=He[t]^(ae&ge?qe[e]:0),be=be?Ye(t,PulseSaw_8580,(ue^(8388608&ue?16777215:0))>>11,0):0):te&ve&&(be=be?Ye(t,PulseSaw_8580,ue>>4,1):0))):te&ve?(be=He[t]>>8,te&Pe?be=Ye(t,TriSaw_8580,be>>4,1):65535<(be+=be*(se=ce/18874368))&&(be=65535-(be-65536)/se)):te&Pe&&(ue=He[t]^(ae&ge?qe[e]:0),be=(ue^(8388608&ue?16777215:0))>>7),te?Ee[t]=be:be=Ee[t],Oe[t]=He[t],qe[e]=oe,v[a+23]&Me[t]?de+=(be-32768)*(Le[t]/256):t%s==2&&v[a+24]&De||(pe+=(be-32768)*(Le[t]/256));return 3&v[1]&&(v[a+27]=be>>8),v[a+28]=Le[3],he=(7&v[a+21])/8+v[a+22]+.2,8580==m?(he=1-Math.exp(he*Qe),ke=Math.pow(2,(4-(v[a+23]>>4))/8)):(he=he<24?.035:1-1.263*Math.exp(he*Ve),ke=95<v[a+23]?8/(v[a+23]>>4):1.41),ue=de+Ke[e]*ke+Ge[e],v[a+24]&Ue&&(pe-=ue),ue=Ke[e]-ue*he,Ke[e]=ue,v[a+24]&Te&&(pe-=ue),ue=Ge[e]+ue*he,Ge[e]=ue,v[a+24]&Ie&&(pe+=ue),pe/i*(15&v[a+24])}function Ye(e,a,t,r){return r&&6581==m&&(t&=2047),Z=(a[t]+Fe[e])/2,Fe[e]=a[t],Z}function Ze(e,a,t,r){for(var n=0;n<4096;n++){for(var s=e[n]=0;s<12;s++){for(var i=0,c=0;c<12;c++)i+=a/Math.pow(t,Math.abs(c-s))*((n>>c&1)-.5);e[n]+=r<=i?Math.pow(2,s):0}e[n]*=12}}TriSaw_8580=new Array(4096),Ze(TriSaw_8580,.8,2.4,.64),PulseSaw_8580=new Array(4096),Ze(PulseSaw_8580,1.4,1.9,.68),PulseTriSaw_8580=new Array(4096),Ze(PulseTriSaw_8580,.8,2.5,.64);var $e=Math.max(M,9),ea=[$e,32,63,95,149,220,267,313,392,977,1954,3126,3907,11720,19532,31251],aa=[Math.ceil($e/9),1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],ta=[1,30,30,30,30,30,30,16,16,16,16,16,16,16,16,8,8,8,8,8,8,8,8,8,8,8,8,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]};return(a.prototype=Object.create(Phaser.Plugins.BasePlugin.prototype)).constructor=a,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=a),exports.SIDPlayerPlugin=a):"undefined"!=typeof define&&define.amd?define("SIDPlayerPlugin",e.SIDPlayerPlugin=a):e.SIDPlayerPlugin=a,a}).call(this);